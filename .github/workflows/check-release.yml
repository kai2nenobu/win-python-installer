name: Check new Python releases

on:
  workflow_dispatch: # Enable manual trigger
  schedule:
  - cron:  '33 0/3 * * *'

jobs:
  check-release:
    runs-on: ubuntu-20.04
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0  # Fetch all history
    - name: Check new tags
      id: check_new_tags
      run: |
        new_tags=$(python3 ci/check_new_tags.py)
        echo "::set-output name=new_tags::${new_tags}"
    - name: Create a pull request if new tags are found
      if: ${{ steps.check_new_tags.outputs.new_tags != '' }}
      uses: peter-evans/create-pull-request@v3
      with:
        branch: new_release
        delete-branch: true
        commit-message: Update the latest releases for ${{ steps.check_new_tags.outputs.new_tags }}
        reviewers: ${{ github.repository_owner }}
        title: âœ¨New release ${{ steps.check_new_tags.outputs.new_tags }}
        body: |
          Some new releases are found. See [python tags](https://github.com/python/cpython/tags).
